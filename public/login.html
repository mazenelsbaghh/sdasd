<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù…Ø¯ÙŠØ± ØªØ¹Ù„ÙŠÙ‚Ø§Øª Facebook</title>

    <!-- Facebook Login Button SDK -->
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/ar_AR/sdk.js"></script>

    <link rel="stylesheet" href="styles.css">
    <style>
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: #1877f2;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
        }

        .login-title {
            font-size: 24px;
            color: #1c1e21;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #65676b;
            margin-bottom: 30px;
        }

        .facebook-login-btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .facebook-login-btn:hover {
            background: #166fe5;
        }

        .permissions-info {
            background: #f0f2f5;
            padding: 20px;
            border-radius: 8px;
            text-align: right;
            margin-top: 20px;
        }

        .permissions-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #1c1e21;
        }

        .permission-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #65676b;
        }

        .permission-icon {
            color: #42a5f5;
            margin-left: 10px;
            font-size: 18px;
        }

        .status-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }

        /* Facebook Login Button */
        .fb-login-button {
            margin: 20px 0;
            text-align: center;
        }

        .fb-login-button>span {
            width: 100% !important;
        }

        /* Custom Login Button */
        .facebook-login-btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: background 0.3s;
        }

        .facebook-login-btn:hover {
            background: #166fe5;
        }

        /* Info Message */
        .info-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: right;
        }

        .info-message p {
            margin: 5px 0;
            color: #856404;
        }

        .info-message ul {
            margin: 10px 0;
            padding-right: 20px;
        }

        .info-message li {
            margin: 5px 0;
            color: #856404;
        }

        .info-message code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #d32f2f;
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="login-logo">f</div>
        <h1 class="login-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ</h1>
        <p class="login-subtitle">Ù…Ø¯ÙŠØ± ØªØ¹Ù„ÙŠÙ‚Ø§Øª Facebook</p>

        <!-- Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© -->
        <div class="info-message">
            <p>âš ï¸ <strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong></p>
            <p>Facebook ÙŠØªØ·Ù„Ø¨ HTTPS Ù„Ù„Ø¹Ù…Ù„. ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø­Ù„ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù…:</p>
            <ul>
                <li><strong>https://localhost:3000</strong> (Ù…Ø¹ Ø´Ù‡Ø§Ø¯Ø© SSL)</li>
                <li>Ø£Ùˆ Ø£Ø¶Ù <strong>localhost</strong> ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Facebook App</li>
            </ul>
            <p style="margin-top: 15px; color: #d32f2f; font-weight: bold;">
                ğŸ”§ <strong>Ù…Ø´ÙƒÙ„Ø© JavaScript SDK:</strong><br>
                ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript SDK" ÙÙŠ Facebook App
            </p>
            <p style="font-size: 14px; margin-top: 10px;">
                Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù <code>FACEBOOK_APP_SETUP.md</code> Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©
            </p>
        </div>

        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø³ÙŠØ· -->
        <button id="simpleLoginBtn" class="facebook-login-btn">
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Facebook
        </button>

        <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© -->
        <button id="retryLoginBtn" class="facebook-login-btn"
            style="margin-top: 10px; background: #17a2b8; display: none;">
            Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        </button>

        <!-- Ø²Ø± ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© -->
        <button id="checkStatusBtn" class="facebook-login-btn" style="margin-top: 10px; background: #666;">
            ÙØ­Øµ Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </button>

        <!-- Ø²Ø± ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <button id="checkConnectionBtn" class="facebook-login-btn" style="margin-top: 10px; background: #28a745;">
            ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Facebook
        </button>

        <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© SDK -->
        <button id="reinitSDKBtn" class="facebook-login-btn"
            style="margin-top: 10px; background: #ffc107; color: #000;">
            Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Facebook SDK
        </button>

        <!-- Ø²Ø± Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Facebook -->
        <button id="goToFacebookBtn" class="facebook-login-btn"
            style="margin-top: 10px; background: #1877f2; color: #fff;">
            Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Facebook Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </button>

        <div id="statusMessage" style="display: none;"></div>

        <!-- Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© -->
        <div class="info-message">
            <h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:</h3>
            <ol>
                <li><strong>ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Facebook Ø£ÙˆÙ„Ø§Ù‹</strong> - Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ <a
                        href="https://www.facebook.com" target="_blank">facebook.com</a></li>
                <li><strong>Ø§Ø¶ØºØ· "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Facebook"</strong> - Ø³ÙŠØ¸Ù‡Ø± Ù†Ø§ÙØ°Ø© Facebook</li>
                <li><strong>Ø£Ø¹Ø· Ø§Ù„Ø£Ø°Ù† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</strong> - Ø§Ø¶ØºØ· "Continue" Ø£Ùˆ "Ù…ØªØ§Ø¨Ø¹Ø©"</li>
                <li><strong>Ø§Ù†ØªØ¸Ø± 30 Ø«Ø§Ù†ÙŠØ©</strong> - Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Facebook</li>
                <li><strong>Ø§Ø¶ØºØ· "ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„"</strong> - Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„</li>
            </ol>
            <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong> ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Facebook ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ø£ÙˆÙ„Ø§Ù‹!</p>
            <p><strong>Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¹Ù…Ù„:</strong> Ø¬Ø±Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Facebook SDK"</p>
        </div>

        <div class="permissions-info">
            <div class="permissions-title">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</div>
            <div class="permission-item">
                <span class="permission-icon">ğŸ“–</span>
                Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
            </div>
            <div class="permission-item">
                <span class="permission-icon">ğŸ’¬</span>
                Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
            </div>
            <div class="permission-item">
                <span class="permission-icon">ğŸ“Š</span>
                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø©
            </div>
        </div>
    </div>

    <!-- Facebook SDK -->
    <script>
        function login() {
            console.log('Login button clicked');
            if (typeof FB === 'undefined') {
                showStatus('Facebook SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡', 'error');
                return;
            }

            showStatus('ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Facebook - Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©', 'success');

            FB.login(function (res) {
                console.log('FB.login result:', res);
                console.log('Response details:', {
                    status: res.status,
                    authResponse: res.authResponse,
                    hasAccessToken: !!res.authResponse?.accessToken,
                    hasUserID: !!res.authResponse?.userID
                });

                if (res.authResponse && res.authResponse.accessToken) {
                    showStatus('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    console.log('Login successful, proceeding to fetch user data...');
                    fetchMe();
                } else if (res.status === 'unknown') {
                    // User didn't complete the authorization
                    showStatus('Ù„Ù… ØªÙƒÙ…Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø£Ø°Ù† - ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„" ÙÙŠ Ù†Ø§ÙØ°Ø© Facebook', 'error');
                    console.log('User did not complete authorization - status: unknown');

                    // Show retry button
                    document.getElementById('retryLoginBtn').style.display = 'block';

                    // Give user specific instructions only after popup interaction
                    showStatus('ØªØ¹Ù„ÙŠÙ…Ø§Øª: 1) Ø§Ø¶ØºØ· "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„" ÙÙŠ Ù†Ø§ÙØ°Ø© Facebook 2) Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªØºÙ„Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© 3) Ø§Ø¶ØºØ· "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"', 'success');
                } else {
                    showStatus('Ù„Ù… ÙŠØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
                    console.log('Login incomplete - status:', res.status);

                    // Show retry button
                    document.getElementById('retryLoginBtn').style.display = 'block';
                }
            }, {
                scope: 'pages_read_engagement,pages_manage_posts,pages_show_list,email',
                return_scopes: true,
                auth_type: 'rerequest' // Force re-request permissions
            });
        }

        // Ø¥Ø¶Ø§ÙØ© event listener Ù„Ù„Ø²Ø±
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('simpleLoginBtn').addEventListener('click', function () {
                login();
            });

            document.getElementById('retryLoginBtn').addEventListener('click', function () {
                login();
            });

            document.getElementById('checkStatusBtn').addEventListener('click', function () {
                if (typeof FB !== 'undefined') {
                    FB.getLoginStatus(handleStatus);
                } else {
                    showStatus('Facebook SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡', 'error');
                }
            });

            document.getElementById('checkConnectionBtn').addEventListener('click', function () {
                checkConnection();
            });

            document.getElementById('reinitSDKBtn').addEventListener('click', function () {
                reinitializeFacebookSDK();
            });

            document.getElementById('goToFacebookBtn').addEventListener('click', function () {
                window.open('https://www.facebook.com', '_blank');
                showStatus('ØªÙ… ÙØªØ­ Facebook ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© - Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù‡Ù†Ø§Ùƒ Ø£ÙˆÙ„Ø§Ù‹', 'success');
            });
        });

        window.fbAsyncInit = function () {
            console.log('fbAsyncInit called');
            try {
                FB.init({
                    appId: '655413053660463',
                    cookie: true,          // Ø¶Ø±ÙˆØ±ÙŠ Ù„Ùˆ Ù‡ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¬Ù„Ø³Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ
                    xfbml: false,
                    version: 'v19.0'       // Ø§Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¹Ù†Ø¯Ùƒ
                });
                console.log('FB.init completed successfully');
                FB.AppEvents.logPageView();
                console.log('Facebook SDK initialized');

                // Check current login status after initialization
                FB.getLoginStatus(handleStatus);
                FB.Event.subscribe('auth.statusChange', handleStatus);

            } catch (error) {
                console.error('Error in FB.init:', error);
            }
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        function handleStatus(response) {
            console.log('auth status:', response);
            if (response.status === 'connected') {
                // Ø¹Ù†Ø¯Ùƒ accessToken Ùˆ userID
                showStatus('Ø£Ù†Øª Ù…ØªØµÙ„ Ø¨Ù€ Facebook Ø¨Ø§Ù„ÙØ¹Ù„!', 'success');
                console.log('User is connected with access token');
                // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API
                fetchMe();
            } else if (response.status === 'not_authorized') {
                // Ù„Ø§Ø²Ù… ØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
                showStatus('Ø£Ù†Øª Ù…ØªØµÙ„ Ø¨Ù€ Facebook Ù„ÙƒÙ† Ù„Ù… ØªÙ…Ù†Ø­ Ø§Ù„Ø£Ø°Ù† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            } else {
                // 'unknown' => Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´ logged in Ù„ÙÙŠØ³Ø¨ÙˆÙƒ Ø£Ùˆ Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù…Ø­Ø¬ÙˆØ¨Ø©
                showStatus('Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Facebook - Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            }
        }

        function fetchMe() {
            FB.api('/me', { fields: 'id,name,email' }, function (r) {
                console.log('ME:', r);
                if (r && !r.error) {
                    console.log('Successfully fetched user data:', r);
                    showStatus(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${r.name}! ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
                    getPages();
                } else {
                    console.error('API error:', r.error);
                    const { message, code, subcode, type, fbtrace_id } = r.error;
                    console.error({ message, code, subcode, type, fbtrace_id });
                    showStatus(`Ø®Ø·Ø£ ÙÙŠ API: ${message} (Code: ${code})`, 'error');
                }
            });
        }

        function getPages() {
            FB.api('/me/accounts', function (response) {
                console.log('Pages response:', response);
                if (response && !response.error && response.data && response.data.length > 0) {
                    showStatus(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${response.data.length} ØµÙØ­Ø© - Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„...`, 'success');
                    // Store data and redirect
                    localStorage.setItem('fbPages', JSON.stringify(response.data));
                    setTimeout(() => {
                        window.location.href = 'https://localhost:3000/';
                    }, 2000);
                } else {
                    console.error('No pages found:', response);
                    if (response.error) {
                        const { message, code, subcode, type, fbtrace_id } = response.error;
                        console.error({ message, code, subcode, type, fbtrace_id });
                        showStatus(`Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØµÙØ­Ø§Øª: ${message} (Code: ${code})`, 'error');
                    } else {
                        showStatus('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙØ­Ø§Øª', 'error');
                    }
                }
            });
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
        }

        function checkLoginStatus() {
            if (typeof FB === 'undefined') {
                showStatus('Facebook SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡', 'error');
                return;
            }

            FB.getLoginStatus(function (response) {
                console.log('Current login status:', response);
                console.log('Status:', response.status);
                console.log('Auth response:', response.authResponse);

                if (response.status === 'connected') {
                    showStatus('Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„!', 'success');
                    if (response.authResponse.accessToken) {
                        getPages(response.authResponse.accessToken);
                    }
                } else if (response.status === 'not_authorized') {
                    showStatus('Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„ÙƒÙ† Ù„Ù… ØªÙ…Ù†Ø­ Ø§Ù„Ø£Ø°Ù† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
                } else {
                    showStatus('Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„', 'error');
                }
            });
        }

        function checkConnection() {
            if (typeof FB === 'undefined') {
                showStatus('Facebook SDK Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡', 'error');
                return;
            }

            // Method 1: Check Facebook SDK status
            FB.getLoginStatus(function (response) {
                console.log('Checking connection status:', response);
                console.log('Status:', response.status);
                console.log('Auth response:', response.authResponse);

                if (response.status === 'connected') {
                    showStatus('Ø£Ù†Øª Ù…ØªØµÙ„ Ø¨Ù€ Facebook Ø¨Ø§Ù„ÙØ¹Ù„!', 'success');
                } else if (response.status === 'not_authorized') {
                    showStatus('Ø£Ù†Øª Ù…ØªØµÙ„ Ø¨Ù€ Facebook Ù„ÙƒÙ† Ù„Ù… ØªÙ…Ù†Ø­ Ø§Ù„Ø£Ø°Ù† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
                } else {
                    // Method 2: Check Facebook cookies manually
                    checkFacebookCookies();
                }
            });
        }

        function checkFacebookCookies() {
            // Check if user has Facebook cookies (indicating they're logged in)
            const cookies = document.cookie.split(';');
            const fbCookies = cookies.filter(cookie =>
                cookie.trim().startsWith('c_user=') ||
                cookie.trim().startsWith('xs=') ||
                cookie.trim().startsWith('datr=')
            );

            console.log('Facebook cookies found:', fbCookies);

            if (fbCookies.length > 0) {
                showStatus('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ cookies Facebook - Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„...', 'success');

                // Try to force a login status refresh
                FB.getLoginStatus(function (response) {
                    console.log('Forced login status check:', response);
                    if (response.status === 'connected' || response.authResponse) {
                        showStatus('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                        statusChangeCallback(response);
                    } else {
                        showStatus('Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Facebook Ù„ÙƒÙ† Ù„Ù… ØªÙ…Ù†Ø­ Ø§Ù„Ø£Ø°Ù† Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
                    }
                }, true); // Force refresh
            } else {
                showStatus('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ cookies Facebook - Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„', 'error');
            }
        }

        function reinitializeFacebookSDK() {
            console.log('Reinitializing Facebook SDK...');
            // Clear existing SDK script
            const facebookScript = document.getElementById('facebook-jssdk');
            if (facebookScript) {
                facebookScript.remove();
            }

            // Re-add the script tag
            const newScript = document.createElement('script');
            newScript.id = 'facebook-jssdk';
            newScript.src = 'https://connect.facebook.net/ar_AR/sdk.js'; // Use ar_AR for Arabic
            newScript.async = true;
            newScript.defer = true;
            newScript.crossOrigin = 'anonymous';
            newScript.onload = function () {
                console.log('Facebook SDK re-initialized successfully.');
                showStatus('Facebook SDK ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                // After re-initialization, you might want to re-check login status or perform other actions
                // For now, just show a success message.
            };
            newScript.onerror = function () {
                console.error('Failed to re-initialize Facebook SDK.');
                showStatus('ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Facebook SDK: Ø¬Ø±Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
            };

            document.head.appendChild(newScript);
        }
    </script>
</body>

</html>